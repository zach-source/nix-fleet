# NixFleet PKI Configuration
#
# This file configures the PKI infrastructure for your fleet.
# Initialize PKI with: nixfleet pki init --config secrets/pki.yaml
#
# Two-tier PKI hierarchy (recommended):
#   Root CA -> Intermediate CA -> Server Certificates
#
# The root CA should be kept offline/secure after creating the intermediate.

# Directory for PKI files (relative to repo root)
directory: secrets/pki

# Age recipients for encrypting private keys
# Get your age public key with: age-keygen -y ~/.config/age/key.txt
# Add all admin keys that should be able to decrypt CA private keys
recipients:
  - age1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  # - age1yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy

# Age identity files for decrypting (optional, can also use --identity flag)
# identities:
#   - ~/.config/age/key.txt

# Root CA configuration
# This CA signs the intermediate CA and should be kept offline
rootCA:
  commonName: "NixFleet Root CA"
  organization: "NixFleet"
  validity: "10y"  # 10 years

# Intermediate CA configuration (recommended)
# This CA signs server certificates and is used for day-to-day operations
intermediateCA:
  commonName: "NixFleet Intermediate CA"
  organization: "NixFleet"
  validity: "5y"   # 5 years

# Default settings for issued certificates
defaults:
  validity: "90d"  # 90 days
  organization: "NixFleet"

# Host certificate definitions (optional)
# Define SANs and certificate configurations per host
hosts:
  # Example: web server with multiple SANs
  # web-1:
  #   sans:
  #     - web-1.example.com
  #     - 10.0.1.11
  #   certificates:
  #     web:
  #       sans:
  #         - www.example.com
  #         - api.example.com
  #       validity: "365d"
  #     mtls:
  #       sans:
  #         - web-1.internal
  #       validity: "30d"

  # Example: database server
  # db-1:
  #   sans:
  #     - db-1.example.com
  #     - 10.0.2.10
  #   certificates:
  #     postgres:
  #       validity: "365d"
  #     replication:
  #       sans:
  #         - db-1.replication.internal
  #       validity: "30d"
